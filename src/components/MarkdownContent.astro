---
// src/components/MarkdownContent.astro
---

<div class="markdown-content">
  <slot />
</div>

<style>
  /* Markdownコンポーネント用スタイル */
  @layer components {
    /* Markdownコンテンツのコンテナスタイル */
    .markdown-content {
      word-wrap: break-word;
      overflow-wrap: break-word;
      line-height: var(--line-height-relaxed);
    }

    /* 見出し - Markdown専用のスタイル */
    .markdown-content :global(h1),
    .markdown-content :global(h2),
    .markdown-content :global(h3),
    .markdown-content :global(h4),
    .markdown-content :global(h5),
    .markdown-content :global(h6) {
      margin-block: var(--space-lg) var(--space-xs);
      margin-inline: 0;
    }
    
    .markdown-content :global(h1) {
      margin-block-start: 0;
    }
    
    .markdown-content :global(h2) {
      border-block-end: var(--border-width-thin) solid rgba(var(--gray-light), 1);
      padding-block-end: 0.3em;
    }
  }

  /* テキスト要素 */
  @layer components {
    .markdown-content :global(p) {
      margin-block-start: 0;
      margin-block-end: var(--space-md);
      margin-inline: 0;
      line-height: var(--line-height-relaxed);
    }
    
    .markdown-content :global(strong),
    .markdown-content :global(b) {
      font-weight: var(--font-weight-bold);
    }
    
    .markdown-content :global(a) {
      color: var(--link-color);
    }
    
    .markdown-content :global(a:hover) {
      color: var(--link-hover-color);
    }

    /* リスト */
    .markdown-content :global(ul),
    .markdown-content :global(ol) {
      margin-block-start: 0;
      margin-block-end: var(--space-md);
      margin-inline: 0;
      padding-inline-start: 2em;
    }
    
    .markdown-content :global(ul) {
      list-style: disc;
    }
    
    .markdown-content :global(ol) {
      list-style: decimal;
    }
    
    .markdown-content :global(li) {
      margin-block-end: var(--space-xs);
    }

    /* テーブル */
    .markdown-content :global(table) {
      width: 100%;
      border-collapse: collapse;
      margin-block-start: 0;
      margin-block-end: var(--space-md);
      margin-inline: 0;
    }
    
    .markdown-content :global(table th) {
      font-weight: var(--font-weight-semibold);
      background-color: rgba(var(--gray-light), var(--opacity-medium));
    }
    
    .markdown-content :global(table th),
    .markdown-content :global(table td) {
      border: var(--border-width-thin) solid rgba(var(--gray-light), 1);
      padding: var(--space-xs) var(--space-sm);
    }
    
    .markdown-content :global(table tr:nth-child(2n)) {
      background-color: rgba(var(--gray-light), var(--opacity-low));
    }

    /* 画像 */
    .markdown-content :global(img) {
      max-width: 100%;
      height: auto;
      margin-block-start: 0;
      margin-block-end: var(--space-md);
      margin-inline: 0;
    }

    .markdown-content :global(code) {
      font-family: Courier, monospace;
    }

    /* コード */
    /* インラインコード用 - pre内にないcodeタグ */
    .markdown-content :global(:not(pre) > code) {
      padding-block: 0.2em;
      padding-inline: 0.4em;
      background-color: rgba(var(--code-bg), 1);
      color: rgb(var(--code-fg));
      border-radius: var(--border-radius-sm);
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 0.85em;
    }
    
    /* コードブロック用 - preタグのスタイリング */
    .markdown-content :global(pre) {
      padding: 1em;
      border-radius: var(--border-radius-lg);
      overflow-x: scroll;
      background-color: rgba(var(--codeblock-bg), 1);
    }
    
    /* コードブロック内のコードタグはShikiによるスタイリングを優先 */
    .markdown-content :global(pre > code) {
      padding: 0;
      font-size: 0.9em;
      line-height: var(--line-height-normal);
      white-space: pre;
      /* 背景色と文字色はShikiによって設定されるため削除 */
    }

    /* 行番号付きコードブロックのスタイル */
    .markdown-content :global(pre[data-line-numbers="true"]),
    .markdown-content :global(pre[data-line-numbers="1"]) {
    }

    /* 行番号のカウンターをリセット */
    .markdown-content :global(pre[data-line-numbers="true"] code),
    .markdown-content :global(pre[data-line-numbers="1"] code) {
      counter-reset: line;
    }

    /* 各行に行番号を追加 */
    .markdown-content :global(pre[data-line-numbers="true"] .line),
    .markdown-content :global(pre[data-line-numbers="1"] .line) {
      display: inline-block;
      width: 100%;
      height: 1rem;
      counter-increment: line;
    }

    .markdown-content :global(pre[data-line-numbers="true"] .line > span) {
      height: 100%;
    }

    /* 行番号の表示 */
    .markdown-content :global(pre[data-line-numbers="true"] .line::before),
    .markdown-content :global(pre[data-line-numbers="1"] .line::before) {
      display: inline-block;
      margin-right: 0.5rem;
      content: counter(line);
      height: 100%;
      width: 2.5em;
      text-align: right;
      color: rgba(var(--gray), var(--opacity-medium));
      font-size: 0.8em;
      padding-right: 0.5em;
      border-right: var(--border-width-thin) solid rgba(var(--gray-light), var(--opacity-low));
      user-select: none; /* 行番号を選択できないようにする */
    }

    /* レスポンシブ対応 */
    @media (max-width: var(--breakpoint-mobile)) {
      .markdown-content :global(pre[data-line-numbers="true"]),
      .markdown-content :global(pre[data-line-numbers="1"]) {
      }
      
      .markdown-content :global(pre[data-line-numbers="true"] .line::before),
      .markdown-content :global(pre[data-line-numbers="1"] .line::before) {
        left: -2.2em;
        width: 1.8em;
      }
    }

    /* 引用 */
    .markdown-content :global(blockquote) {
      border-inline-start: var(--space-2xs) solid rgba(var(--gray-light), 1);
      padding-inline-start: var(--space-md);
      padding-block: 0;
      padding-inline-end: 0;
      margin-block-start: 0;
      margin-block-end: var(--space-md);
      margin-inline: 0;
      color: rgb(var(--gray));
      font-size: 1em;
    }

    /* 水平線 */
    .markdown-content :global(hr) {
      border: none;
      border-block-start: var(--border-width-thin) solid rgb(var(--gray-light));
      margin-block: var(--space-md);
      margin-inline: 0;
    }
  }
</style>
